\documentclass[../main.tex]{subfiles}
\begin{document}
\section{模型建立和求解}
\subsection{问题1}
\subsubsection{模型准备}
\paragraph{太阳高度角和太阳方位角}
记 \(\alpha _{s}\) 为太阳高度角，\(\gamma _{s}\)为太阳方位角。已知：
\begin{equation}
\sin \alpha _{s} = \cos \delta \cos \varphi \cos \omega + \sin \delta \sin \varphi
\end{equation}
\begin{equation}
\cos \gamma _{s} = \frac{\sin \delta -\sin \alpha_{s} \sin \varphi}{\cos \alpha _{s} \cos \varphi}
\end{equation}
记 \( \varphi\) 为纬度，\(\omega\) 为太阳时角，\(ST\) 为当地时间， \(\delta\) 为太阳赤纬角，有
\begin{equation}
\omega = \frac{\pi}{12} ( ST - 12)
\end{equation}
\begin{equation}
\sin \delta = \sin \frac{2 \pi D}{365} \sin \big(\frac{2\pi}{360} \cdot 23.45\big)
\end{equation}
设太阳中心发出的光线的方向向量为 \(\vec\lambda _{i} = (x,  y , z)\)。若将\(\vec \lambda_{i}\)单位化，容易知道
\begin{equation}
\vec \lambda _{i} = ({-} \cos \alpha _{s} \sin \gamma_{s} ,{-} \cos \alpha_{s} \cos \gamma_{s}, {-} \sin \alpha_{s}) 
\end{equation}
\paragraph{相关公式}
法向直接辐射照度 DNI 按照下面公式近似计算：
\[
\begin{aligned}
\mathrm{DNI} = G_{0} \bigg[ a + b \cdot \exp\Big\{{-}\frac{c}{\sin \alpha_{s}}\Big\}\bigg]\\
a = 0.4237 + 0.00821 (6 - H) ^{2} \\
b = 0.5055 + 0.00595(6.5 - H) ^{2} \\
c = 0.2711 + 0.01858 (2.5 - H) ^{2}
\end{aligned}
\]
其中 \(G_{0}\) 是太阳常数。镜场的输出热功率为 \(E_{\mathrm{field}}\) 为
\begin{equation}
E_{\mathrm{field}} = \mathrm{DNI} \cdot \sum _{i} ^{N} A_{i} \eta _{i}
\end{equation}
定日镜光学效率\(\eta\)为
\begin{equation}
\eta = \eta _{\mathrm{s b}} \eta _{\cos} \eta _{\mathrm{at}} \eta _{\mathrm{trunc}} \eta _{\mathrm{ref}}
\end{equation}
其中 \(\eta _{\mathrm{s b}}\) 为阴影遮挡效率。阴影遮挡损失是指由于阴影或者是遮挡导致的效率损失，\(\eta _{\cos}\) 是余弦效率，大气透射率 \(\eta _{\mathrm{at}}\) 由下面公式确定：
\begin{equation}
\eta _{\mathrm{at}} = 0.99321 - 0.0001176 d _{\mathrm{HR}} + 1.97 \times 10 ^{-8} \times d _{\mathrm{HR}} ^{2}
\end{equation}
其中 \(d _{\mathrm{HR}}\)是镜面中心到集热器中心的距离。截断效率为\(\eta _{\mathrm{trunc}}\) 。因为部分反射光束没有照射到中心塔塔顶的集热器导致效率损失。

设入射光线为 \(\vec S\)，反射光线为 \(\vec R\)，余弦效率使用下面公式计算：
\begin{equation}
\eta _{\cos} = \cos \big(\arccos (\vec R \cdot \vec S) / 2\big)
\end{equation}
\paragraph{旋转矩阵}
已知地面坐标系 \(x y z\)以圆形区域的圆心为原点，正北方向为 \(y\) 轴正方向，正东方向为 \(x\) 轴正方向，垂直地面向上的方向为 \(z\) 轴正方向。假设已知一个定日镜的镜面中心在地面坐标系的坐标 \(N = (x_0,  y_0 , d)\)，其中 \(d\) 是安装高度，现在以定日镜镜面中心为坐标原点，镜面法向为 \(z\) 轴，如图所示建立坐标系，记为 \(x'y'z'\)。

设 \(\vec n\) 为该镜面的法向量，方向向外，\(\theta\) 为 \(\vec n\) 和 竖直方向上的夹角，\(\varphi\) 是 \(\vec n\) 水平方向和正东方向的夹角。可以得到坐标变换的公式：
\begin{equation}
\begin{pmatrix}
x_{1}\\
y_1\\
z_1
\end{pmatrix}
= M
\begin{pmatrix}
x_2\\
y_2\\
z_2
\end{pmatrix} +
\begin{pmatrix}
x_0\\
y_0\\
d
\end{pmatrix}
\end{equation}
其中 \((x_2,y_2,z_2)\) 是镜面坐标系里点的坐标，\((x_1,y_1,z_1)\) 是地面坐标系里点的坐标，\(M\) 是旋转矩阵，其为
\begin{equation}\label{equ:transM}
M =
% \begin{pmatrix}
% \cos \theta & - \sin \theta & 0 \\
% \sin \theta & \cos \theta & 0\\
% 0 & 0 & 1
% \end{pmatrix} \cdot
% \begin{pmatrix}
% 1 & 0 & 0\\
% 0 & \cos \varphi & - \sin \varphi\\
% 0 & \sin \varphi & \cos \varphi
% \end{pmatrix}
% =
\begin{pmatrix}
\cos \theta & - \cos \varphi & \sin \varphi \sin \theta\\
\sin \theta & \cos \varphi \cos \theta & - \sin \varphi \cos \theta\\
0 & \sin \varphi & \cos \varphi
\end{pmatrix}
\end{equation}
特别地，当 \(\theta = 0\) 的时候，旋转矩阵 \(M\) 退化为单位矩阵。
于是使用定日镜 \(A\)上一点在镜面坐标系 \(x'y'z'\) 的坐标 \(N_{A}\) \((x_{A}, y_{A},0)\)，可知其在地面坐标系之中的坐标\(N\) \((x, y , z)\)：
\begin{equation}
\begin{pmatrix}
x\\
y\\
z
\end{pmatrix}
=
\begin{pmatrix}
x_{A} \cos \varphi - y_{A} \cos \varphi \sin \theta + x_0\\
x_{A} \sin \theta + y_{A} \cos \varphi \cos \theta + y_{0} \\
y_{A} \sin \varphi + d
\end{pmatrix}
\end{equation}


\paragraph{阴影遮挡效率的计算}
阴影遮挡效率 \(\eta _{\mathrm{s b}}\) 在进行定日镜光学效率的计算之中计算比较复杂的部分。为了计算阴影遮挡效率，需要计算定日镜上某点是否有阴影遮挡损失，而阴影遮挡损失分为以下三种情况：
% TODO cite require
\begin{enumerate}
\item 入射光线被塔挡住
\item 入射光线被其他定日镜挡住（阴影）
\item 反射光线被其他定日镜挡住（挡光）
\end{enumerate}
对于定日镜 A，建立相对于定日镜A的坐标系，以镜面中心为原点水平方向为 \(x\) 轴，平行于镜面、垂直于 \(x\) 轴方向为 \(y\) 轴，以垂直于镜面向上为 \(z\) 轴。
已知定日镜 A 上的一点 \(N_{A} = (x_{A}, y_{A})\)和入射光线 \(\vec {\lambda _{i}}\)。


Step1. 判断入射光线是否被中心塔遮挡，需将定日镜 A 坐标系之中的点 \(N_{A}\) 转化为相对于地面的坐标 \(N\)，随后根据 \(\vec {\lambda _{i}}\)，计算入射光线的反向延长线与中心塔是否有交点，
为此，可以直接联立直线方程和中心塔圆柱方程，查看是否有解。

由于直接联立方程计算量大，为了简化计算，本文根据入射光线和中心塔塔顶所在水平面的交点 \(N_{h} = (x _{h} , y_{h}, h)\)判断是否有遮挡。

下面给出几何模型。过点 \(N\) 作平面和中心塔圆柱相切，设相切作成的直线和中心塔塔顶所在平面的交点为 \(R\)。设中心塔在塔顶所在平面的圆的圆心为 \(O\)，\(A\) 为\(N\)在中心塔塔顶所在平面内的投影，\(\vec \lambda _{i} '\)为 \(\vec \lambda _{i}\) 在平面内的投影。如下图所示
\input fig_ta.tex
\begin{enumerate}
\item 若是入射光线水平方向的夹角过大，也即
\begin{equation}
\cos \langle \overrightarrow {OA}, \vec {\lambda _{i} '} \rangle \le \frac{\vert AR \vert }{\vert OA \vert }
\end{equation}
则不会被遮挡；
\item 若是 \(N_{h}\) 更加靠近定日镜一侧，也即
\begin{equation}
\vert {\it A N}_{h}\vert \le \vert {\it AR\,} \vert
\end{equation}并且 \(N_{h}\) 不在圆内，则不会被遮挡；
\item 否则入射光线会被遮挡。
\end{enumerate}

Step2. 判断入射光线是否被相邻定日镜挡住
为了简化计算，假设发生阴影的两面定日镜相互平行，采用投影法。给定两个定日镜 \(A, B\)，将 \(B\) 镜投影到镜面 \(A\) 上，为此，先计算 \(B\) 的中心投影到 \(A\) 上的关于 \(A\) 镜面系的坐标。

% TODO

Step3. 判断反射光线是否被相邻定日镜挡住
已知反射光线 \(\vec \lambda _{o} = (x_0,y_0,z_0)\)和镜面 \(A\) 上反射点在地面坐标系的坐标 \(N\)\((x, y, z)\)。联立反射光线的直线方程和B镜面的平面方程，可以解得光线和 B 的交点在地面坐标系下的坐标 \(N'\)。

随后运用 equ~(\ref{equ:transM}) 将 \(N'\) 坐标转换为 \(B\) 镜面系下的坐标 \(N_{B}\):
\[
N_{B} = M (N' - O)
\]
其中 \(O = (x_{B} , y_{B} , d)\)，也即B镜面的中心。

\paragraph{光锥}
因为太阳光并不是平行光，在定日镜上的每个点发出的反射光实际是一个光锥，其半角展宽为 \(4.65 \, \mathrm{m}\mathrm{rad}\)，在太阳发散角内均匀追迹若干光线作为入射光。因为定日镜是平面镜，于是入射光和反射光完全对称。

以太阳中心发出的光线的反射光 \(\vec\lambda _{o} \) 为 \(z\) 轴，以镜面上的反射点 \(N\) 为远点，建立关于 \(\vec \lambda _{o}\) 的三维直角坐标系

对于光锥内的一束光线 \(\vec S _{0}\)，记 \(\tau\) 为光线和 \(\vec\lambda _{o}\) 所成的角，其取值范围为 \([0, 4.65]\)，\(\sigma\) 为光线和 \(X\) 轴所成的角，其取值范围为 \([0 , 2\pi ]\)，于是光线的坐标可以表示为：
\[
\vec S _{0} = (\sin \sigma \cos \tau, \sin \sigma \sin \tau, \cos \sigma)
\]
通过变换矩阵，可以将光线在光锥坐标系下的坐标转换为地面坐标系下的坐标 \(\vec S\)。
% TODO
\paragraph{截断效率的计算}
计算截断效率，需要确定光锥之中的某光线是否有截断损失，若是其没有打在集热器上，则该光线发生了截断损失。为了判断截断损失，采取的思路和上文确定中心塔造成的阴影损失的思路类似。

已知反射点 \(N\) 和 反射光线 \(\vec S\)，确定光线 1) 和中心塔塔顶所在平面的交点 \(N'\)；2) 和集热器底部所在的平面的交点 \(N''\)。剩余符号沿用上文，如下图所示：

\begin{figure}[H]
\centering
\begin{subfigure}[b]{0.4\textwidth}
\centering
\input fig_trunc.tex
\caption{竖直面示意图}
\end{subfigure}
\begin{subfigure}[b]{0.4\textwidth}
\centering
\input fig_trunc2.tex
\caption{水平面示意图}
\end{subfigure}
\caption{判断截断损失的示意图}
\end{figure}

分三个步骤进行截断损失的判断：
\begin{enumerate}
\item 若是 \( \displaystyle\cos \langle \overrightarrow{OA}, \vec S' \rangle\le \frac{\vert AR \vert}{\vert OA \vert}\)，则发生截断损失
\item 若是 \(\vert AN'\vert \le \vert AR \vert\)且 \(N'\) 不在圆内，则发生截断损失
\item 若是 \(N''\) 在圆 \(O\) 内，或是 \(\vert AN'' \vert \ge \vert AR \vert\)
\end{enumerate}

\end{document}
